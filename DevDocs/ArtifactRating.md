### 圣遗物评分系统白皮书

披萨小助手在 2023 年中的时候（v2.8.0）由 Bill Haku 引入了来自[爱丽丝工房的圣遗物评分系统](https://github.com/Kamihimmel/artifactrating)。

这套系统的评分方法虽有够权威，但有着几个已知的小问题（截至 2024 年 3 月 15 日）：

1. 负责评分的数值策划（ForAeons）自称已经自原神 4.1 版开始退坑，没能参与之后的圣遗物评分准则判定包准。
2. 此后的新角色的圣遗物评分准则由 Kamihimmel 提供，但有些角色长期没被制定评分准则。
3. 对主词条的评价一直缺席。
4. 通用的一套评分准则无法应对某些角色的多元玩法，举例：如雷万葉、种门雷军，等。

论及对这套评分系统的最佳救赎，就是从程式上彻底重构（包括对 TypeScript 的应用，但核心处理算法不变）。这是后话。

原神披萨助手从 v4.1.2 版开始，由 Shiki Suen 将这套评分系统用 Swift 彻底重写＋重构，且做了如下变化：

1. 补充了所有剩余角色的圣遗物词条评分权重表，相关依据参考自 Bilibili 原神百科。
2. 引入了一套选项机制，可以在评分时启用某些特殊的评分准则。
    - 特殊评分规则不会上传到披萨助手的统计伺服器，上传的内容会是「不附加任何这种规则」的数据。
3. 新增可选的评分准则「评分时照顾被故意培养成超绽放打手的雷系角色」：
    - 该机制并非用来评价圣遗物本身，而是用来评价这套圣遗物对当前角色而言的价值。
    - 触发条件：当前雷系角色装备了「乐园套 教官套 饰金套 深林套」的 2+2 或者四件套。
    - 一旦触发该条件，则无条件地将元素精通的评分权重推到最高。
    - 这不会影响到其他词条的评分权重。
4. 新增可选的评分准则「评分时也考虑圣遗物主词条」：
    - 该机制并非用来评价圣遗物本身，而是用来评价这套圣遗物对当前角色而言的价值。
    - 该机制仅对钟杯帽有效。其中，对于属性伤害杯的话，仅对契合属性有效：
        - 预设情况下，契合属性就是当前角色属性。但这套系统允许开发者手动指定例外。
            - 比如说优菈、辛焱、雷泽这三个角色的实际契合属性是物理属性，只适合携带物理伤害杯。
                - 给他们带冰伤杯、火伤杯、雷伤杯的话，反而会被扣分。下文会解释。
    - 该机制的计算基准 = (圣遗物的培养等级 * 0.25) + 1。
        - 不额外 +1 的话，0 级圣遗物不会得到任何主词条加算评分。聊胜于无。
        - 在此基础上，根据当前角色就不同词条的评分权重来计算主词条加成。
    - 因应该机制的存在的原因，钟杯帽的各自的总分会被扣去 10%，防止当前角色的圣遗物总分膨胀。
        - 所以说，在这种情况下，属性伤害杯的属性与角色不契合的话，反而会被扣分。
    - 因为主词条种类多了「元素伤害加成」与「治疗加成」，所以新增了相关的 Roll 值。
        - 元素伤害加成的四星 Roll 是 6.3、五星 Roll 是 7.0。
        - 治疗加成的四星 Roll 是 4.8、五星 Roll 是 5.4。
5. 因应下述变化，这次也对 FDCBEAS 圣遗物评价等级系统做了一些调整，见下文。

修改前的圣遗物评价等级系统的规则（JavaScript）：
```js
const artifactScoreTier = {
  1: {
    SSS: 1000,
    SS: 900,
    "S+": 850,
    S: 800,
    "A+": 750,
    A: 700,
    B: 600,
    C: 500,
    F: 0,
  },
};
```

修改后的圣遗物评价等级系统的规则（Swift）：
```swift
public static func tellTier(score: Int) -> String {
    // 给脸黑的玩家们一点面子，不然太沮丧了。
    // 另外，考虑到钟杯帽主词条带来的分数上涨，这里也稍微将 S 段位的分数线划分得更严格一些。
    // 原先刚好满足 S 的分数现在只能分到 S- 分数段。
    switch score {
    case 1000...: return "SSS"
    case 950 ..< 1000: return "SS"
    case 900 ..< 950: return "S+"
    case 850 ..< 900: return "S"
    case 800 ..< 850: return "S-"
    case 750 ..< 800: return "A+"
    case 700 ..< 750: return "A"
    case 650 ..< 700: return "B+"
    case 600 ..< 650: return "B"
    case 550 ..< 600: return "B-"
    case 500 ..< 550: return "C"
    case 450 ..< 500: return "D"
    default: return "F"
    }
}
```

$ EOF.
